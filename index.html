<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ë§ˆì¼“ ë¸Œë ˆì“° | Herdvibe</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.1.0/dist/chartjs-plugin-annotation.min.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600;700&family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<script src="https://t1.kakaocdn.net/kakao_js_sdk/2.7.1/kakao.min.js" crossorigin="anonymous" async></script>
<style>
:root{--hv-primary:#3b82f6;--hv-primary-light:#60a5fa;--hv-primary-dark:#2563eb;--hv-primary-glow:rgba(59,130,246,0.12);--hv-up:#22c55e;--hv-up-bg:rgba(34,197,94,0.1);--hv-down:#ef4444;--hv-down-bg:rgba(239,68,68,0.1);--hv-warning:#f59e0b;--hv-warning-bg:rgba(245,158,11,0.1);--hv-neutral:#6b7280;--hv-bg-base:#000;--hv-bg-surface:#0a0a0a;--hv-bg-card:#111;--hv-bg-card-hover:#181818;--hv-bg-elevated:#1a1a1a;--hv-text-primary:#e5e5e5;--hv-text-secondary:#8a8a8a;--hv-text-tertiary:#555;--hv-text-muted:#3a3a3a;--hv-border:rgba(255,255,255,0.06);--hv-border-strong:rgba(255,255,255,0.12);--hv-font-display:'Plus Jakarta Sans',sans-serif;--hv-font-body:'Noto Sans KR',-apple-system,BlinkMacSystemFont,sans-serif;--hv-font-mono:'JetBrains Mono','SF Mono',monospace;--hv-space-xs:8px;--hv-space-sm:12px;--hv-space-md:16px;--hv-space-lg:24px;--hv-space-xl:32px;--hv-radius-sm:6px;--hv-radius-md:10px;--hv-radius-lg:14px;--hv-shadow-sm:0 1px 3px rgba(0,0,0,.5);--hv-shadow-md:0 4px 12px rgba(0,0,0,.6);--hv-shadow-lg:0 8px 32px rgba(0,0,0,.7);--hv-transition-fast:150ms ease;--hv-transition:250ms ease;--hv-max-width:960px;--hv-header-height:60px;--ma20:#10b981;--ma50:#3b82f6;--ma100:#f59e0b;--ma200:#ef4444}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}html{font-size:16px;scroll-behavior:smooth;-webkit-font-smoothing:antialiased;-webkit-text-size-adjust:100%;overflow-x:hidden}body{font-family:var(--hv-font-body);background:var(--hv-bg-base);color:var(--hv-text-primary);line-height:1.6;min-height:100vh;overflow-x:hidden}::selection{background:var(--hv-primary);color:#fff}::-webkit-scrollbar{width:5px;height:5px}::-webkit-scrollbar-track{background:var(--hv-bg-base)}::-webkit-scrollbar-thumb{background:#333;border-radius:3px}

/* HEADER */
.hv-header{position:sticky;top:0;z-index:100;height:var(--hv-header-height);background:rgba(0,0,0,.9);backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);border-bottom:1px solid var(--hv-border);display:flex;align-items:center;padding:0 var(--hv-space-lg)}.hv-header-inner{width:100%;max-width:var(--hv-max-width);margin:0 auto;display:flex;align-items:center;justify-content:center;position:relative}.hv-header-center{display:flex;flex-direction:column;align-items:center;text-align:center}.hv-header-center h1{font-family:var(--hv-font-display);font-size:1.3rem;font-weight:600;color:var(--hv-text-primary);white-space:nowrap}.hv-header-category{font-size:.7rem;color:var(--hv-text-tertiary);font-weight:500;text-transform:uppercase;letter-spacing:.08em}.hv-header-right{position:absolute;right:0;display:flex;align-items:center;gap:var(--hv-space-xs)}.hv-update-badge{font-family:var(--hv-font-mono);font-size:.688rem;color:var(--hv-text-tertiary);white-space:nowrap;display:flex;align-items:center;gap:6px}.hv-live-dot{width:5px;height:5px;background:var(--hv-up);border-radius:50%;animation:pulse 2s infinite}@keyframes pulse{0%,100%{opacity:1}50%{opacity:.3}}

.hv-page{max-width:var(--hv-max-width);margin:0 auto;padding:var(--hv-space-lg)}

/* TABS */
.asset-tabs{display:flex;gap:4px;margin-bottom:var(--hv-space-lg);background:var(--hv-bg-card);border:1px solid var(--hv-border);border-radius:12px;padding:4px;max-width:560px;margin-left:auto;margin-right:auto}.asset-tab{flex:1;display:flex;align-items:center;justify-content:center;gap:6px;padding:10px 8px;border-radius:9px;border:none;background:transparent;color:var(--hv-text-secondary);font-family:var(--hv-font-body);font-size:.85rem;font-weight:500;cursor:pointer;transition:all .2s ease;-webkit-tap-highlight-color:transparent}.asset-tab:hover{color:var(--hv-text-primary);background:rgba(255,255,255,.03)}.asset-tab.active{background:var(--hv-bg-elevated);color:var(--hv-text-primary);font-weight:600}.tab-symbol{font-weight:700;letter-spacing:.02em}.tab-sub{font-size:.68rem;color:var(--hv-text-tertiary);font-weight:400}

/* CARDS */
.hv-card{background:var(--hv-bg-card);border:1px solid var(--hv-border);border-radius:var(--hv-radius-lg);overflow:hidden;margin-bottom:var(--hv-space-lg)}.hv-card-head{display:flex;align-items:center;justify-content:space-between;padding:14px var(--hv-space-lg);border-bottom:1px solid var(--hv-border);flex-wrap:wrap;gap:var(--hv-space-xs)}.hv-card-head h2{font-size:.875rem;font-weight:600;color:var(--hv-text-primary)}.hv-card-body{padding:var(--hv-space-lg)}

/* TIME RANGE */
.tf-tabs{display:flex;gap:3px;background:var(--hv-bg-base);border-radius:8px;padding:3px}.tf-tab{padding:5px 12px;border-radius:6px;border:none;background:transparent;color:var(--hv-text-muted);font-family:var(--hv-font-body);font-size:.72rem;font-weight:500;cursor:pointer;transition:all .15s ease}.tf-tab:hover{color:var(--hv-text-secondary)}.tf-tab.active{background:var(--hv-bg-elevated);color:var(--hv-text-primary);font-weight:600}

/* MA TOGGLES */
.ma-toggles{display:flex;gap:6px;flex-wrap:wrap}.ma-toggle{display:flex;align-items:center;gap:5px;padding:5px 10px;border-radius:6px;border:1px solid var(--hv-border);background:transparent;color:var(--hv-text-secondary);font-family:var(--hv-font-mono);font-size:.7rem;font-weight:500;cursor:pointer;transition:all .15s ease;-webkit-tap-highlight-color:transparent}.ma-toggle:hover{border-color:var(--hv-border-strong)}.ma-toggle.active{border-color:var(--hv-border-strong);color:var(--hv-text-primary)}.ma-toggle .dot{width:8px;height:8px;border-radius:2px;transition:opacity .15s}.ma-toggle:not(.active) .dot{opacity:.3}.ma-toggle:not(.active){opacity:.4}

/* CHART */
.chart-wrap{position:relative;height:320px;padding:var(--hv-space-md) var(--hv-space-lg)}.chart-wrap canvas{width:100%!important}.chart-wrap.tall{height:380px}

/* SNAPSHOT */
.snapshot-row{display:flex;align-items:center;justify-content:space-between;padding:12px 0;border-bottom:1px solid rgba(255,255,255,.04)}.snapshot-row:last-child{border-bottom:none}.snapshot-label{font-family:var(--hv-font-mono);font-size:.78rem;color:var(--hv-text-tertiary);min-width:60px}.snapshot-bar{flex:1;height:5px;background:var(--hv-bg-base);border-radius:3px;overflow:hidden;margin:0 14px}.snapshot-bar-fill{height:100%;border-radius:3px;transition:width .6s ease}.snapshot-val{font-family:var(--hv-font-mono);font-weight:700;font-size:.85rem;min-width:50px;text-align:right}

/* SIGNALS */
.signals-grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}.signal-card{background:var(--hv-bg-surface);border:1px solid var(--hv-border);border-radius:var(--hv-radius-md);padding:var(--hv-space-lg);text-align:center}.signal-type{font-size:.72rem;font-weight:600;text-transform:uppercase;letter-spacing:.06em;margin-bottom:8px;display:flex;align-items:center;justify-content:center;gap:6px}.signal-indicator{width:6px;height:6px;border-radius:50%}.signal-score{font-family:var(--hv-font-mono);font-size:2.8rem;font-weight:800;line-height:1}.signal-max{font-family:var(--hv-font-mono);font-size:.72rem;color:var(--hv-text-tertiary);margin-top:4px}.score-breakdown{margin-top:14px;border-top:1px solid var(--hv-border);padding-top:10px}.score-row{display:flex;justify-content:space-between;padding:4px 0;font-size:.72rem;color:var(--hv-text-tertiary)}.score-row-value{font-family:var(--hv-font-mono);color:var(--hv-text-secondary);font-weight:500}

/* PROB TABLE */
.prob-match-info{font-size:.78rem;color:var(--hv-text-secondary);margin-bottom:var(--hv-space-md);line-height:1.8}.prob-table{width:100%;border-collapse:collapse;font-size:.78rem}.prob-table th{text-align:left;color:var(--hv-text-tertiary);font-weight:500;padding:8px 10px;border-bottom:1px solid var(--hv-border);font-family:var(--hv-font-mono);font-size:.7rem}.prob-table td{padding:10px;border-bottom:1px solid rgba(255,255,255,.03);font-family:var(--hv-font-mono)}.prob-positive{color:var(--hv-up)}.prob-negative{color:var(--hv-down)}.prob-badge{display:inline-block;padding:2px 8px;border-radius:4px;font-weight:600;font-size:.72rem}

/* COMPARE */
.compare-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}.compare-col{background:var(--hv-bg-surface);border:1px solid var(--hv-border);border-radius:var(--hv-radius-md);padding:14px}.compare-col-title{font-family:var(--hv-font-display);font-weight:700;font-size:.9rem;color:var(--hv-text-primary);margin-bottom:10px;text-align:center}.compare-row{display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px solid rgba(255,255,255,.03);font-size:.75rem}.compare-row:last-child{border-bottom:none}.compare-label{color:var(--hv-text-tertiary);font-family:var(--hv-font-mono)}.compare-value{font-family:var(--hv-font-mono);font-weight:600}

/* SHARE */
.share-bar{display:flex;align-items:center;justify-content:space-between;padding:12px var(--hv-space-lg);border-top:1px solid var(--hv-border);background:var(--hv-bg-surface)}.share-bar-preview{font-size:.75rem;color:var(--hv-text-tertiary);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:50%;line-height:1.4;font-family:var(--hv-font-mono)}.share-bar-preview span{color:var(--hv-text-secondary);font-weight:500}.share-bar-buttons{display:flex;align-items:center;gap:6px;flex-shrink:0}.share-btn{display:inline-flex;align-items:center;gap:6px;padding:7px 14px;border-radius:6px;font-size:.75rem;font-weight:600;font-family:var(--hv-font-body);cursor:pointer;transition:all var(--hv-transition-fast);border:1px solid var(--hv-border-strong);background:var(--hv-bg-card);color:#999;white-space:nowrap}.share-btn:hover{transform:translateY(-1px);box-shadow:var(--hv-shadow-sm);color:var(--hv-text-primary)}.share-btn svg{flex-shrink:0}.share-btn--x:hover{border-color:#fff;color:#fff;background:#111}.share-btn--kakao:hover{border-color:#FEE500;color:#191919;background:#FEE500}.share-btn--tg:hover{border-color:#26A5E4;color:#fff;background:rgba(38,165,228,.15)}.share-btn--ig:hover{border-color:#E4405F;color:#fff;background:rgba(228,64,95,.15)}.share-btn--copy:hover{border-color:var(--hv-primary);color:var(--hv-primary-light);background:var(--hv-primary-glow)}
.inline-share{display:flex;align-items:center;justify-content:center;gap:6px;padding:12px 0;border-top:1px solid var(--hv-border)}.inline-share .lbl{font-size:10px;color:var(--hv-text-muted);margin-right:4px}.inline-share .share-btn{padding:6px 10px}

/* TOAST */
.toast-wrap{position:fixed;bottom:20px;right:20px;z-index:200;display:flex;flex-direction:column;gap:8px}.toast{background:var(--hv-bg-elevated);border:1px solid var(--hv-border-strong);border-radius:var(--hv-radius-md);padding:10px 18px;font-size:.788rem;color:var(--hv-text-primary);box-shadow:var(--hv-shadow-lg);animation:toastIn .3s ease;border-left:3px solid var(--hv-up)}@keyframes toastIn{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}

.hidden{display:none!important}

/* RESPONSIVE */
@media(max-width:768px){:root{--hv-header-height:52px}.hv-page{padding:var(--hv-space-md)}.hv-header{padding:0 var(--hv-space-md)}.hv-update-badge{display:none}.hv-header-center h1{font-size:1.1rem}.chart-wrap{height:260px}.chart-wrap.tall{height:300px}.signals-grid{grid-template-columns:1fr}.compare-grid{grid-template-columns:1fr}.share-bar{flex-direction:column;gap:10px;align-items:stretch}.share-bar-preview{max-width:100%}.share-bar-buttons{justify-content:center;flex-wrap:wrap}.share-btn span.label-text{display:none}.share-btn{padding:8px 10px}.inline-share .lbl{display:none}}
@media(max-width:520px){.hv-page{padding:12px 10px 24px}.asset-tabs{padding:3px;gap:2px}.asset-tab{padding:9px 4px;font-size:.82rem}.tab-sub{display:none}.chart-wrap{height:240px}.chart-wrap.tall{height:270px}.hv-card-head{padding:12px 14px}.ma-toggles{gap:4px}.ma-toggle{padding:4px 8px;font-size:.65rem}.signal-score{font-size:2.2rem}}
</style>
</head>
<body>

<!-- HEADER -->
<header class="hv-header"><div class="hv-header-inner"><div class="hv-header-center"><h1>ë§ˆì¼“ ë¸Œë ˆì“°</h1><span class="hv-header-category">% of Stocks Above Moving Average</span></div><div class="hv-header-right"><div class="hv-update-badge" id="updateBadge"><span class="hv-live-dot"></span><span>--</span></div></div></div></header>

<div class="hv-page">

  <!-- TABS -->
  <div class="asset-tabs" id="assetTabs">
    <button class="asset-tab active" data-tab="SPY"><span class="tab-symbol">SPY</span><span class="tab-sub">S&P 500</span></button>
    <button class="asset-tab" data-tab="QQQ"><span class="tab-symbol">QQQ</span><span class="tab-sub">Nasdaq 100</span></button>
    <button class="asset-tab" data-tab="DIA"><span class="tab-symbol">DIA</span><span class="tab-sub">Dow 30</span></button>
    <button class="asset-tab" data-tab="COMPARE"><span class="tab-symbol">âŸ· ë¹„êµ</span></button>
  </div>

  <!-- SINGLE INDEX VIEW -->
  <div id="singleView">

    <!-- PRICE CHART -->
    <div class="hv-card">
      <div class="hv-card-head">
        <h2 id="priceTitle">ì¸ë±ìŠ¤ ê°€ê²©</h2>
        <div class="tf-tabs" id="timeRange">
          <button class="tf-tab" data-range="63">3M</button>
          <button class="tf-tab" data-range="126">6M</button>
          <button class="tf-tab" data-range="252">1Y</button>
          <button class="tf-tab" data-range="504">2Y</button>
          <button class="tf-tab active" data-range="0">5Y</button>
        </div>
      </div>
      <div class="chart-wrap"><canvas id="priceChart"></canvas></div>
      <div class="inline-share" id="inlineShare1"></div>
    </div>

    <!-- BREADTH CHART -->
    <div class="hv-card">
      <div class="hv-card-head">
        <h2>% of Stocks Above Moving Average</h2>
        <div class="ma-toggles" id="maToggles">
          <button class="ma-toggle active" data-ma="20" onclick="toggleMA('20')"><span class="dot" style="background:var(--ma20)"></span>20 MA</button>
          <button class="ma-toggle active" data-ma="50" onclick="toggleMA('50')"><span class="dot" style="background:var(--ma50)"></span>50 MA</button>
          <button class="ma-toggle active" data-ma="100" onclick="toggleMA('100')"><span class="dot" style="background:var(--ma100)"></span>100 MA</button>
          <button class="ma-toggle active" data-ma="200" onclick="toggleMA('200')"><span class="dot" style="background:var(--ma200)"></span>200 MA</button>
        </div>
      </div>
      <div class="chart-wrap tall"><canvas id="breadthChart"></canvas></div>
      <div class="inline-share" id="inlineShare2"></div>
    </div>

    <!-- SNAPSHOT + SIGNALS -->
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:var(--hv-space-lg);margin-bottom:var(--hv-space-lg)">
      <div class="hv-card" style="margin-bottom:0">
        <div class="hv-card-head"><h2>í˜„ì¬ ë¸Œë ˆë“œìŠ¤ ìŠ¤ëƒ…ìƒ·</h2></div>
        <div class="hv-card-body" id="snapshotArea"></div>
      </div>
      <div class="hv-card" style="margin-bottom:0">
        <div class="hv-card-head"><h2>íƒ‘ / ë°”í…€ ì‹œê·¸ë„</h2><span style="font-family:var(--hv-font-mono);font-size:.65rem;color:var(--hv-text-muted)" id="vixBadge"></span></div>
        <div class="hv-card-body"><div class="signals-grid" id="signalArea"></div></div>
      </div>
    </div>

    <!-- HISTORICAL PROBABILITY -->
    <div class="hv-card">
      <div class="hv-card-head"><h2>íˆìŠ¤í† ë¦¬ì»¬ í™•ë¥  ë¶„ì„</h2></div>
      <div class="hv-card-body" id="histProbArea"></div>
    </div>

  </div>

  <!-- COMPARE VIEW -->
  <div id="compareView" class="hidden">
    <div class="hv-card">
      <div class="hv-card-head"><h2>ì¸ë±ìŠ¤ ë¹„êµ Â· í˜„ì¬ ë¸Œë ˆë“œìŠ¤</h2></div>
      <div class="hv-card-body"><div class="compare-grid" id="compareGrid"></div></div>
    </div>
    <div class="hv-card">
      <div class="hv-card-head"><h2>ë¸Œë ˆë“œìŠ¤ ë¹„êµ Â· % Above 20 MA</h2></div>
      <div class="chart-wrap tall"><canvas id="compareChart"></canvas></div>
    </div>
  </div>

  <!-- BOTTOM SHARE BAR -->
  <div style="background:var(--hv-bg-card);border:1px solid var(--hv-border);border-radius:var(--hv-radius-lg);overflow:hidden">
    <div class="share-bar" style="border-top:none">
      <div class="share-bar-preview" id="sharePreview"><span>ë§ˆì¼“ ë¸Œë ˆì“° ëŒ€ì‹œë³´ë“œ</span> â€” herdvibe.com</div>
      <div class="share-bar-buttons">
        <button class="share-btn share-btn--x" onclick="doShare('twitter',this)"><svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg><span class="label-text">íŠ¸ìœ„í„°</span></button>
        <button class="share-btn share-btn--kakao" onclick="doShare('kakao',this)"><svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M12 3C6.477 3 2 6.463 2 10.691c0 2.724 1.8 5.112 4.508 6.458l-1.148 4.265a.5.5 0 0 0 .764.533l4.94-3.26c.304.02.612.03.936.03 5.523 0 10-3.462 10-7.735C22 6.463 17.523 3 12 3z"/></svg><span class="label-text">ì¹´ì¹´ì˜¤í†¡</span></button>
        <button class="share-btn share-btn--tg" onclick="doShare('telegram',this)"><svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.479.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/></svg><span class="label-text">í…”ë ˆê·¸ë¨</span></button>
        <button class="share-btn share-btn--ig" onclick="doShare('instagram',this)"><svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zM12 0C8.741 0 8.333.014 7.053.072 2.695.272.273 2.69.073 7.052.014 8.333 0 8.741 0 12c0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98C8.333 23.986 8.741 24 12 24c3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98C15.668.014 15.259 0 12 0zm0 5.838a6.162 6.162 0 100 12.324 6.162 6.162 0 000-12.324zM12 16a4 4 0 110-8 4 4 0 010 8zm6.406-11.845a1.44 1.44 0 100 2.881 1.44 1.44 0 000-2.881z"/></svg><span class="label-text">ì¸ìŠ¤íƒ€</span></button>
        <button class="share-btn share-btn--copy" onclick="doShare('link',this)"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg><span class="label-text">ë§í¬ ë³µì‚¬</span></button>
      </div>
    </div>
  </div>

</div>

<script>
/* ===== SHARE SYSTEM ===== */
var SHARE_URL='https://herdvibe.com/70';
var xI='<svg width="13" height="13" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>';
var kI='<svg width="13" height="13" viewBox="0 0 24 24" fill="currentColor"><path d="M12 3C6.477 3 2 6.463 2 10.691c0 2.724 1.8 5.112 4.508 6.458l-1.148 4.265a.5.5 0 0 0 .764.533l4.94-3.26c.304.02.612.03.936.03 5.523 0 10-3.462 10-7.735C22 6.463 17.523 3 12 3z"/></svg>';
var tI='<svg width="13" height="13" viewBox="0 0 24 24" fill="currentColor"><path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.479.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/></svg>';
var lI='<svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>';

function makeInlineShare(el){if(!el)return;el.innerHTML='<span class="lbl">ê³µìœ </span><button class="share-btn share-btn--x" onclick="doShare(\'twitter\',this)">'+xI+'</button><button class="share-btn share-btn--kakao" onclick="doShare(\'kakao\',this)">'+kI+'</button><button class="share-btn share-btn--tg" onclick="doShare(\'telegram\',this)">'+tI+'</button><button class="share-btn share-btn--copy" onclick="doShare(\'link\',this)">'+lI+'</button>';}

function ensureKakao(){try{if(typeof Kakao!=='undefined'&&!Kakao.isInitialized())Kakao.init('a43ed7b39fac35458f4f9df925a279b5');return typeof Kakao!=='undefined'&&Kakao.isInitialized();}catch(e){return false;}}
ensureKakao();

function kakaoShare(){if(!ensureKakao()){copyToClipboard(SHARE_URL);toast('ë§í¬ ë³µì‚¬ì™„ë£Œ! ì¹´ì¹´ì˜¤í†¡ì— ë¶™ì—¬ë„£ê¸° í•˜ì„¸ìš”');return;}try{Kakao.Share.sendDefault({objectType:'feed',content:{title:'ë§ˆì¼“ ë¸Œë ˆì“° ëŒ€ì‹œë³´ë“œ',description:'S&P 500, Nasdaq 100, Dow 30 êµ¬ì„±ì¢…ëª© ì´ë™í‰ê· ì„  ë¶„ì„ Â· íƒ‘/ë°”í…€ ì‹œê·¸ë„',imageUrl:'https://raw.githubusercontent.com/kittycapital/kittycapital.github.io/main/assets/herdvibe-og.png',link:{mobileWebUrl:SHARE_URL,webUrl:SHARE_URL}},buttons:[{title:'ëŒ€ì‹œë³´ë“œ ë³´ê¸°',link:{mobileWebUrl:SHARE_URL,webUrl:SHARE_URL}}]});}catch(e){copyToClipboard(SHARE_URL);toast('ë§í¬ ë³µì‚¬ì™„ë£Œ! ì¹´ì¹´ì˜¤í†¡ì— ë¶™ì—¬ë„£ê¸° í•˜ì„¸ìš”');}}

function copyToClipboard(text){try{window.parent.postMessage({type:'clipboard',text:text},'*');}catch(e){}try{navigator.clipboard.writeText(text);}catch(e){}}

function flashCopied(btn){if(!btn)return;var orig=btn.innerHTML;btn.style.background='#22c55e';btn.style.color='#fff';btn.style.borderColor='#22c55e';var hasLabel=btn.querySelector('.label-text');btn.innerHTML='<svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="3" stroke-linecap="round"><path d="M5 13l4 4L19 7"/></svg>'+(hasLabel?'<span class="label-text" style="color:#fff">ë³µì‚¬ë¨!</span>':'');setTimeout(function(){btn.style.background='';btn.style.color='';btn.style.borderColor='';btn.innerHTML=orig;},2000);}

function getShareText(){var idx=DATA?.indices?.[currentTab]||DATA?.indices?.SPY;if(!idx)return'ë§ˆì¼“ ë¸Œë ˆì“° â€” herdvibe.com';var c=idx.current;return'ğŸ“Š '+idx.name+' Market Breadth\n>20MA: '+c.pct_above_20.toFixed(1)+'%\n>50MA: '+c.pct_above_50.toFixed(1)+'%\n>200MA: '+c.pct_above_200.toFixed(1)+'%\në°”í…€ ì‹œê·¸ë„: '+Math.round(c.bottom_score)+'/100\n\n#MarketBreadth #íˆ¬ì via herdvibe.com';}

function doShare(p,btn){var u=SHARE_URL;var t=encodeURIComponent(getShareText());var eu=encodeURIComponent(u);switch(p){case'twitter':window.open('https://twitter.com/intent/tweet?text='+t+'&url='+eu,'_blank');break;case'telegram':window.open('https://t.me/share/url?url='+eu+'&text='+t,'_blank');break;case'kakao':kakaoShare();break;case'instagram':copyToClipboard(u);flashCopied(btn);toast('ë§í¬ ë³µì‚¬ì™„ë£Œ! ì¸ìŠ¤íƒ€ê·¸ë¨ì— ë¶™ì—¬ë„£ê¸° í•˜ì„¸ìš”');break;case'link':copyToClipboard(u);flashCopied(btn);toast('ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤ âœ“');break;}}

function toast(msg){var c=document.querySelector('.toast-wrap');if(!c){c=document.createElement('div');c.className='toast-wrap';document.body.appendChild(c);}var t=document.createElement('div');t.className='toast';t.textContent=msg;c.appendChild(t);setTimeout(function(){t.style.opacity='0';t.style.transform='translateY(12px)';t.style.transition='.3s';setTimeout(function(){t.remove();},300);},3000);}

function updateSharePreview(){var idx=DATA?.indices?.[currentTab];if(idx){document.getElementById('sharePreview').innerHTML='<span>'+idx.name+' ë§ˆì¼“ ë¸Œë ˆì“°</span> â€” herdvibe.com';}}

/* ===== WATERMARK PLUGIN ===== */
var watermarkPlugin={id:'herdvibeWatermark',beforeDraw:function(chart){var ctx=chart.ctx,ca=chart.chartArea;if(!ca)return;ctx.save();ctx.font='700 42px "Plus Jakarta Sans",sans-serif';ctx.fillStyle='rgba(255,255,255,0.03)';ctx.textAlign='center';ctx.textBaseline='middle';ctx.fillText('Herdvibe.com',(ca.left+ca.right)/2,(ca.top+ca.bottom)/2);ctx.restore();}};

/* ===== STATE ===== */
var DATA=null,currentTab='SPY',currentRange=0,charts={};
var maVisible={20:true,50:true,100:true,200:true};
Chart.defaults.color='#555';Chart.defaults.borderColor='rgba(255,255,255,0.06)';Chart.defaults.font.family="'Noto Sans KR',sans-serif";

/* ===== DATA LOADING ===== */
async function loadData(){try{var r=await fetch('https://raw.githubusercontent.com/kittycapital/market-breadth/main/data/market_breadth.json');if(!r.ok)throw new Error('not found');DATA=await r.json();init();}catch(e){console.error(e);DATA=generateSampleData();init();}}

function generateSampleData(){var n=1260,dates=[];var d=new Date(2021,1,16);while(dates.length<n){if(d.getDay()!==0&&d.getDay()!==6)dates.push(d.toISOString().slice(0,10));d=new Date(d.getTime()+86400000);}function rw(s,v,n){var a=[s];for(var i=1;i<n;i++)a.push(Math.max(2,Math.min(98,a[i-1]+(50-a[i-1])*0.01+(Math.random()-0.5)*v)));return a.map(function(x){return Math.round(x*100)/100;});}function price(s,n){var a=[s];for(var i=1;i<n;i++)a.push(a[i-1]*(1+(Math.random()-0.48)*0.02));return a.map(function(x){return Math.round(x*100)/100;});}function sigs(b,n){var bo=[],to=[];for(var i=0;i<n;i++){var bs=0,ts=0;if(b.pct_above_20[i]<15)bs+=25;if(b.pct_above_50[i]<25)bs+=20;if(b.pct_above_100[i]<35)bs+=15;if(b.pct_above_200[i]<45)bs+=10;if(b.pct_above_20[i]>85)ts+=20;if(b.pct_above_50[i]>80)ts+=15;if(b.pct_above_100[i]>80)ts+=15;if(b.pct_above_200[i]>85)ts+=10;bo.push(Math.min(100,bs));to.push(Math.min(100,ts));}return{bottom_score:bo,top_score:to};}var indices={},cfgs={SPY:{p:400,name:'S&P 500'},QQQ:{p:330,name:'Nasdaq 100'},DIA:{p:320,name:'Dow 30'}};for(var k in cfgs){var c=cfgs[k],b={pct_above_20:rw(60,6,n),pct_above_50:rw(58,4.5,n),pct_above_100:rw(55,3.5,n),pct_above_200:rw(62,2.5,n)},sig=sigs(b,n),pr=price(c.p,n);indices[k]={name:c.name,dates:dates,prices:pr,breadth:b,signals:sig,current:{pct_above_20:b.pct_above_20[n-1],pct_above_50:b.pct_above_50[n-1],pct_above_100:b.pct_above_100[n-1],pct_above_200:b.pct_above_200[n-1],bottom_score:sig.bottom_score[n-1],top_score:sig.top_score[n-1]},historical_probability:{tolerance:5,match_count:8,"5d":{avg:0.8,positive_pct:62.5,max:3.2,min:-1.5},"20d":{avg:3.1,positive_pct:75.0,max:8.5,min:-2.1},"60d":{avg:6.4,positive_pct:87.5,max:14.2,min:-1.8}}};}var vixArr=rw(18,3,n);return{generated_at:new Date().toISOString(),indices:indices,vix:{current:vixArr[n-1],dates:dates,values:vixArr}};}

/* ===== INIT ===== */
function init(){
  var vix=DATA.vix.current;
  document.querySelector('#updateBadge span:last-child').textContent=DATA.generated_at.slice(0,16).replace('T',' ');
  document.getElementById('vixBadge').innerHTML='VIX <span style="color:'+(vix>25?'var(--hv-down)':'var(--hv-up)')+';font-weight:700">'+vix+'</span>';
  document.querySelectorAll('.asset-tab').forEach(function(btn){btn.addEventListener('click',function(){document.querySelectorAll('.asset-tab').forEach(function(b){b.classList.remove('active');});btn.classList.add('active');currentTab=btn.dataset.tab;render();});});
  document.querySelectorAll('#timeRange .tf-tab').forEach(function(btn){btn.addEventListener('click',function(){document.querySelectorAll('#timeRange .tf-tab').forEach(function(b){b.classList.remove('active');});btn.classList.add('active');currentRange=parseInt(btn.dataset.range);renderCharts();});});
  render();
}

function render(){
  if(currentTab==='COMPARE'){document.getElementById('singleView').classList.add('hidden');document.getElementById('compareView').classList.remove('hidden');renderCompare();}
  else{document.getElementById('singleView').classList.remove('hidden');document.getElementById('compareView').classList.add('hidden');renderCharts();renderSnapshot();renderSignals();renderHistProb();}
  updateSharePreview();makeInlineShare(document.getElementById('inlineShare1'));makeInlineShare(document.getElementById('inlineShare2'));
}

/* ===== MA TOGGLE ===== */
function toggleMA(ma){
  maVisible[ma]=!maVisible[ma];
  var btn=document.querySelector('.ma-toggle[data-ma="'+ma+'"]');
  btn.classList.toggle('active',maVisible[ma]);
  if(charts.breadth){
    var idx={20:0,50:1,100:2,200:3}[ma];
    charts.breadth.data.datasets[idx].hidden=!maVisible[ma];
    charts.breadth.update();
  }
}

/* ===== CHARTS ===== */
function sliceData(arr,range){if(!range||range===0)return arr;return arr.slice(-range);}

function renderCharts(){
  var idx=DATA.indices[currentTab];if(!idx)return;
  var range=currentRange,dates=sliceData(idx.dates,range),prices=sliceData(idx.prices,range);
  var b20=sliceData(idx.breadth.pct_above_20,range),b50=sliceData(idx.breadth.pct_above_50,range),b100=sliceData(idx.breadth.pct_above_100,range),b200=sliceData(idx.breadth.pct_above_200,range);

  document.getElementById('priceTitle').textContent=idx.name+' ê°€ê²©';

  /* Price Chart */
  if(charts.price)charts.price.destroy();
  var priceCtx=document.getElementById('priceChart').getContext('2d');
  var priceGrad=priceCtx.createLinearGradient(0,0,0,300);
  priceGrad.addColorStop(0,'rgba(59,130,246,0.12)');priceGrad.addColorStop(1,'rgba(59,130,246,0)');

  charts.price=new Chart(priceCtx,{type:'line',plugins:[watermarkPlugin],data:{labels:dates,datasets:[{label:currentTab,data:prices,borderColor:'#3b82f6',backgroundColor:priceGrad,fill:true,borderWidth:1.5,pointRadius:0,tension:0.1}]},options:{responsive:true,maintainAspectRatio:false,interaction:{intersect:false,mode:'index'},plugins:{legend:{display:false},tooltip:{backgroundColor:'rgba(10,10,10,0.95)',titleColor:'#e5e5e5',bodyColor:'#8a8a8a',borderColor:'rgba(255,255,255,0.08)',borderWidth:1,padding:12,cornerRadius:8,displayColors:false,titleFont:{family:"'JetBrains Mono',monospace",size:11},bodyFont:{family:"'JetBrains Mono',monospace",size:11,weight:600},callbacks:{label:function(ctx){return currentTab+': $'+ctx.parsed.y.toFixed(2);}}}},scales:{x:{grid:{color:'rgba(255,255,255,0.03)'},ticks:{color:'#555',font:{family:"'JetBrains Mono',monospace",size:10},maxTicksLimit:8,maxRotation:0}},y:{position:'right',grid:{color:'rgba(255,255,255,0.03)'},ticks:{color:'#555',font:{family:"'JetBrains Mono',monospace",size:10},callback:function(v){return'$'+v.toFixed(0);}}}}}});

  /* Breadth Chart */
  if(charts.breadth)charts.breadth.destroy();
  var bCtx=document.getElementById('breadthChart').getContext('2d');

  charts.breadth=new Chart(bCtx,{type:'line',plugins:[watermarkPlugin],data:{labels:dates,datasets:[
    {label:'20 MA',data:b20,borderColor:'#10b981',borderWidth:1.5,pointRadius:0,tension:0.2,hidden:!maVisible[20]},
    {label:'50 MA',data:b50,borderColor:'#3b82f6',borderWidth:1.5,pointRadius:0,tension:0.2,hidden:!maVisible[50]},
    {label:'100 MA',data:b100,borderColor:'#f59e0b',borderWidth:1.5,pointRadius:0,tension:0.2,hidden:!maVisible[100]},
    {label:'200 MA',data:b200,borderColor:'#ef4444',borderWidth:1.5,pointRadius:0,tension:0.2,hidden:!maVisible[200]}
  ]},options:{responsive:true,maintainAspectRatio:false,interaction:{intersect:false,mode:'index'},plugins:{legend:{display:false},tooltip:{backgroundColor:'rgba(10,10,10,0.95)',titleColor:'#e5e5e5',bodyColor:'#8a8a8a',borderColor:'rgba(255,255,255,0.08)',borderWidth:1,padding:12,cornerRadius:8,titleFont:{family:"'JetBrains Mono',monospace",size:11},bodyFont:{family:"'JetBrains Mono',monospace",size:11},callbacks:{label:function(ctx){return ctx.dataset.label+': '+ctx.parsed.y.toFixed(1)+'%';}}},annotation:{annotations:{obZone:{type:'box',yMin:80,yMax:100,backgroundColor:'rgba(239,68,68,0.04)',borderWidth:0},osZone:{type:'box',yMin:0,yMax:20,backgroundColor:'rgba(59,130,246,0.04)',borderWidth:0},obLine:{type:'line',yMin:80,yMax:80,borderColor:'rgba(239,68,68,0.15)',borderWidth:1,borderDash:[4,4],label:{content:'ê³¼ì—´',display:true,position:'start',font:{size:9,family:"'JetBrains Mono',monospace"},color:'rgba(239,68,68,0.35)',backgroundColor:'transparent'}},osLine:{type:'line',yMin:20,yMax:20,borderColor:'rgba(59,130,246,0.15)',borderWidth:1,borderDash:[4,4],label:{content:'ê³¼ë§¤ë„',display:true,position:'start',font:{size:9,family:"'JetBrains Mono',monospace"},color:'rgba(59,130,246,0.35)',backgroundColor:'transparent'}}}}},scales:{x:{grid:{color:'rgba(255,255,255,0.03)'},ticks:{color:'#555',font:{family:"'JetBrains Mono',monospace",size:10},maxTicksLimit:8,maxRotation:0}},y:{position:'right',min:0,max:100,grid:{color:'rgba(255,255,255,0.03)'},ticks:{color:'#555',font:{family:"'JetBrains Mono',monospace",size:10},callback:function(v){return v+'%';},stepSize:20}}}}});
}

/* ===== SNAPSHOT ===== */
function renderSnapshot(){
  var idx=DATA.indices[currentTab],c=idx.current;
  var items=[{l:'> 20 MA',v:c.pct_above_20,cl:'--ma20'},{l:'> 50 MA',v:c.pct_above_50,cl:'--ma50'},{l:'> 100 MA',v:c.pct_above_100,cl:'--ma100'},{l:'> 200 MA',v:c.pct_above_200,cl:'--ma200'}];
  document.getElementById('snapshotArea').innerHTML=items.map(function(item){
    var vc=item.v>70?'var(--hv-up)':item.v>40?'var(--hv-warning)':item.v>20?'#f97316':'var(--hv-down)';
    return '<div class="snapshot-row"><span class="snapshot-label">'+item.l+'</span><div class="snapshot-bar"><div class="snapshot-bar-fill" style="width:'+item.v+'%;background:var('+item.cl+')"></div></div><span class="snapshot-val" style="color:'+vc+'">'+item.v.toFixed(1)+'%</span></div>';
  }).join('');
}

/* ===== SIGNALS ===== */
function getSignalColor(s){if(s>=80)return'var(--hv-down)';if(s>=60)return'#f97316';if(s>=30)return'var(--hv-warning)';return'var(--hv-up)';}
function getSignalLabel(s){if(s>=80)return'ê·¹ë‹¨ì ';if(s>=60)return'ê°•í•¨';if(s>=30)return'ì£¼ì˜';return'ì•½í•¨';}

function renderSignals(){
  var idx=DATA.indices[currentTab],c=idx.current,vix=DATA.vix.current;
  var bc=getSignalColor(c.bottom_score),tc=getSignalColor(c.top_score);
  document.getElementById('signalArea').innerHTML='<div class="signal-card"><div class="signal-type" style="color:'+bc+'"><span class="signal-indicator" style="background:'+bc+'"></span>ë°”í…€ ì‹œê·¸ë„</div><div class="signal-score" style="color:'+bc+'">'+Math.round(c.bottom_score)+'</div><div class="signal-max">/100 Â· '+getSignalLabel(c.bottom_score)+'</div><div class="score-breakdown"><div class="score-row"><span>ë¸Œë ˆë“œìŠ¤ ê¸°ì—¬</span><span class="score-row-value">'+Math.min(70,Math.round(c.bottom_score*0.8))+'ì </span></div><div class="score-row"><span>VIX ê¸°ì—¬ ('+vix+')</span><span class="score-row-value">+'+Math.max(0,Math.round(c.bottom_score*0.2))+'ì </span></div></div></div><div class="signal-card"><div class="signal-type" style="color:'+tc+'"><span class="signal-indicator" style="background:'+tc+'"></span>íƒ‘ ì‹œê·¸ë„</div><div class="signal-score" style="color:'+tc+'">'+Math.round(c.top_score)+'</div><div class="signal-max">/100 Â· '+getSignalLabel(c.top_score)+'</div><div class="score-breakdown"><div class="score-row"><span>ë¸Œë ˆë“œìŠ¤ ê¸°ì—¬</span><span class="score-row-value">'+Math.min(75,Math.round(c.top_score*0.85))+'ì </span></div><div class="score-row"><span>VIX ê¸°ì—¬ ('+vix+')</span><span class="score-row-value">+'+Math.max(0,Math.round(c.top_score*0.15))+'ì </span></div></div></div>';
}

/* ===== HISTORICAL PROBABILITY ===== */
function renderHistProb(){
  var idx=DATA.indices[currentTab],hp=idx.historical_probability,c=idx.current;
  if(!hp){document.getElementById('histProbArea').innerHTML='<p style="color:var(--hv-text-muted);font-size:.78rem">ë°ì´í„° ë¶€ì¡±ìœ¼ë¡œ ë¶„ì„ ë¶ˆê°€</p>';return;}
  var periods=[{key:'5d',label:'1ì£¼ í›„'},{key:'20d',label:'1ê°œì›” í›„'},{key:'60d',label:'3ê°œì›” í›„'}];
  document.getElementById('histProbArea').innerHTML='<div class="prob-match-info">í˜„ì¬ >20MA: '+c.pct_above_20.toFixed(1)+'% Â· >50MA: '+c.pct_above_50.toFixed(1)+'% ê¸°ì¤€<br>ê³¼ê±° 5ë…„ê°„ ìœ ì‚¬ êµ¬ê°„ (Â±'+hp.tolerance+'%) <strong style="color:var(--hv-primary-light)">'+hp.match_count+'íšŒ</strong> ë°œìƒ</div><table class="prob-table"><thead><tr><th>ê¸°ê°„</th><th>í‰ê·  ìˆ˜ìµë¥ </th><th>ì–‘ìˆ˜ í™•ë¥ </th><th>ìµœëŒ€</th><th>ìµœì†Œ</th></tr></thead><tbody>'+periods.map(function(p){var d=hp[p.key];if(!d)return'';return'<tr><td style="font-weight:600;color:var(--hv-text-primary)">'+p.label+'</td><td class="'+(d.avg>=0?'prob-positive':'prob-negative')+'">'+(d.avg>=0?'+':'')+d.avg+'%</td><td><span class="prob-badge" style="background:'+(d.positive_pct>=70?'rgba(34,197,94,0.12);color:var(--hv-up)':d.positive_pct>=50?'rgba(245,158,11,0.12);color:var(--hv-warning)':'rgba(239,68,68,0.12);color:var(--hv-down)')+'">'+d.positive_pct+'%</span></td><td class="prob-positive">+'+d.max+'%</td><td class="prob-negative">'+d.min+'%</td></tr>';}).join('')+'</tbody></table>';
}

/* ===== COMPARE ===== */
function renderCompare(){
  var keys=['SPY','QQQ','DIA'];
  document.getElementById('compareGrid').innerHTML=keys.map(function(key){var idx=DATA.indices[key],c=idx.current;var items=[{l:'>20MA',v:c.pct_above_20},{l:'>50MA',v:c.pct_above_50},{l:'>100MA',v:c.pct_above_100},{l:'>200MA',v:c.pct_above_200},{l:'ë°”í…€',v:c.bottom_score,sig:true},{l:'íƒ‘',v:c.top_score,sig:true}];return'<div class="compare-col"><div class="compare-col-title">'+key+'</div>'+items.map(function(item){var color;if(item.sig)color=getSignalColor(item.v);else color=item.v>70?'var(--hv-up)':item.v>40?'var(--hv-warning)':item.v>20?'#f97316':'var(--hv-down)';return'<div class="compare-row"><span class="compare-label">'+item.l+'</span><span class="compare-value" style="color:'+color+'">'+(item.sig?Math.round(item.v):item.v.toFixed(1)+'%')+'</span></div>';}).join('')+'</div>';}).join('');

  if(charts.compare)charts.compare.destroy();
  var ctx=document.getElementById('compareChart').getContext('2d');
  var colors={SPY:'#3b82f6',QQQ:'#8b5cf6',DIA:'#f59e0b'};
  charts.compare=new Chart(ctx,{type:'line',plugins:[watermarkPlugin],data:{labels:DATA.indices.SPY.dates,datasets:keys.map(function(key){return{label:key,data:DATA.indices[key].breadth.pct_above_20,borderColor:colors[key],borderWidth:1.5,pointRadius:0,tension:0.2};})},options:{responsive:true,maintainAspectRatio:false,interaction:{intersect:false,mode:'index'},plugins:{legend:{display:true,labels:{color:'#8a8a8a',font:{family:"'JetBrains Mono',monospace",size:11},usePointStyle:true,pointStyleWidth:20}},tooltip:{backgroundColor:'rgba(10,10,10,0.95)',titleColor:'#e5e5e5',bodyColor:'#8a8a8a',borderColor:'rgba(255,255,255,0.08)',borderWidth:1,padding:12,cornerRadius:8,titleFont:{family:"'JetBrains Mono',monospace",size:11},bodyFont:{family:"'JetBrains Mono',monospace",size:11},callbacks:{label:function(ctx){return ctx.dataset.label+': '+ctx.parsed.y.toFixed(1)+'%';}}},annotation:{annotations:{obLine:{type:'line',yMin:80,yMax:80,borderColor:'rgba(239,68,68,0.15)',borderWidth:1,borderDash:[4,4]},osLine:{type:'line',yMin:20,yMax:20,borderColor:'rgba(59,130,246,0.15)',borderWidth:1,borderDash:[4,4]}}}},scales:{x:{grid:{color:'rgba(255,255,255,0.03)'},ticks:{color:'#555',font:{family:"'JetBrains Mono',monospace",size:10},maxTicksLimit:8,maxRotation:0}},y:{position:'right',min:0,max:100,grid:{color:'rgba(255,255,255,0.03)'},ticks:{color:'#555',font:{family:"'JetBrains Mono',monospace",size:10},callback:function(v){return v+'%';},stepSize:20}}}}});
}

/* ===== IFRAME RESIZE ===== */
var _lastH=0,_ht;
function sendHeight(){clearTimeout(_ht);_ht=setTimeout(function(){var h=document.body.offsetHeight;if(Math.abs(h-_lastH)>5){_lastH=h;window.parent.postMessage({type:'resize',height:h},'*');}},150);}
window.addEventListener('message',function(e){if(e.data&&e.data.type==='requestResize'){_lastH=0;sendHeight();}});

/* ===== BOOT ===== */
loadData();
sendHeight();window.addEventListener('resize',sendHeight);new MutationObserver(sendHeight).observe(document.body,{childList:true,subtree:true});
var resizeTimer;window.addEventListener('resize',function(){clearTimeout(resizeTimer);resizeTimer=setTimeout(function(){if(DATA&&currentTab!=='COMPARE')renderCharts();},250);});
</script>
</body>
</html>
